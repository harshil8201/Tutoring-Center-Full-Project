<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="author" content="Untree.co" />
    <link rel="shortcut icon" href="favicon.png" />

    <meta name="description" content="" />
    <meta name="keywords" content="bootstrap, bootstrap4" />

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link href="css/tiny-slider.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <title>
      Furni Free Bootstrap 5 Template for Furniture and Interior Design Websites
      by Untree.co
    </title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>

  <body>
    <!-- Start Header/Navigation -->
    <nav
      class="custom-navbar navbar navbar navbar-expand-md navbar-dark bg-dark"
      arial-label="Furni navigation bar"
    >
      <div class="container">
        <a class="navbar-brand" href="index.html"
          >ProgLearn Hub<span>.</span></a
        >

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarsFurni"
          aria-controls="navbarsFurni"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarsFurni">
          <ul class="custom-navbar-nav navbar-nav ms-auto mb-2 mb-md-0">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li><a class="nav-link" href="shop.html">Shop</a></li>
            <li><a class="nav-link" href="about.html">About us</a></li>
            <li><a class="nav-link" href="services.html">Services</a></li>
            <li><a class="nav-link" href="blog.html">Blog</a></li>
            <li><a class="nav-link" href="contact.html">Contact us</a></li>
            <li><a class="nav-link" href="orders.html">Orders</a></li>
            <li class="nav-item active">
              <a class="nav-link" href="login.html">Login</a>
            </li>
          </ul>

          <ul class="custom-navbar-cta navbar-nav mb-2 mb-md-0 ms-5">
            <li>
              <a class="nav-link" href="cart.html"
                ><img src="images/cart.svg"
              /></a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Header/Navigation -->

    <!-- Start Hero Section -->
    <div class="hero">
      <div class="container">
        <div class="row justify-content-between">
          <div class="col-lg-5">
            <div class="intro-excerpt">
              <h1>Login</h1>
              <p class="mb-4">
                Explore ProgLearn's diverse array of courses, meticulously
                crafted to cater to every learner's needs and interests. From
                programming to Technology, our comprehensive services offer
                something for everyone, empowering individuals worldwide to
                pursue their passions and achieve their goals.
              </p>
              <p>
                <a href="" class="btn btn-secondary me-2">Shop Now</a
                ><a href="#" class="btn btn-white-outline">Explore</a>
              </p>
            </div>
          </div>
          <div class="col-lg-7">
            <div class="hero-img-wrap">
              <img
                src="https://cdni.iconscout.com/illustration/premium/thumb/login-illustration-download-in-svg-png-gif-file-formats--select-an-account-join-the-forum-password-digital-marketing-pack-business-illustrations-8333958.png?f=webp"
                class="img-fluid"
                style="height: 550px; width: 550px; object-fit: scale-down"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- End Hero Section -->

    <!-- Login Form -->
    <!-- HTML Structure for display login or user email -->
    <div id="loginOrRegister"></div>

    <!-- Start Footer Section -->
    <footer class="footer-section">
      <div class="container relative">
        <div class="sofa-img">
          <img
            src="images/Pic1.png"
            alt="Image"
            class="img-fluid"
            style="border-radius: 15%"
          />
        </div>

        <div class="row">
          <div class="col-lg-8">
            <div class="subscription-form">
              <h3 class="d-flex align-items-center">
                <span class="me-1"
                  ><img
                    src="images/envelope-outline.svg"
                    alt="Image"
                    class="img-fluid" /></span
                ><span>Subscribe to Newsletter</span>
              </h3>

              <form action="#" class="row g-3">
                <div class="col-auto">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Enter your name"
                  />
                </div>
                <div class="col-auto">
                  <input
                    type="email"
                    class="form-control"
                    placeholder="Enter your email"
                  />
                </div>
                <div class="col-auto">
                  <button class="btn btn-primary">
                    <span class="fa fa-paper-plane"></span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>

        <div class="row g-5 mb-5">
          <div class="col-lg-4">
            <div class="mb-4 footer-logo-wrap">
              <a href="#" class="footer-logo">ProgLearn Hub<span>.</span></a>
            </div>
            <p class="mb-4">
              Donec facilisis quam ut purus rutrum lobortis. Donec vitae odio
              quis nisl dapibus malesuada. Nullam ac aliquet velit. Aliquam
              vulputate velit imperdiet dolor tempor tristique. Pellentesque
              habitant
            </p>

            <ul class="list-unstyled custom-social">
              <li>
                <a href="#"><span class="fa fa-brands fa-facebook-f"></span></a>
              </li>
              <li>
                <a href="#"><span class="fa fa-brands fa-twitter"></span></a>
              </li>
              <li>
                <a href="#"><span class="fa fa-brands fa-instagram"></span></a>
              </li>
              <li>
                <a href="#"><span class="fa fa-brands fa-linkedin"></span></a>
              </li>
            </ul>
          </div>

          <div class="col-lg-8">
            <div class="row links-wrap">
              <div class="col-6 col-sm-6 col-md-3">
                <ul class="list-unstyled">
                  <li><a href="#">About us</a></li>
                  <li><a href="#">Services</a></li>
                  <li><a href="#">Blog</a></li>
                  <li><a href="#">Contact us</a></li>
                </ul>
              </div>

              <div class="col-6 col-sm-6 col-md-3">
                <ul class="list-unstyled">
                  <li><a href="#">Support</a></li>
                  <li><a href="#">Knowledge base</a></li>
                  <li><a href="#">Live chat</a></li>
                </ul>
              </div>

              <div class="col-6 col-sm-6 col-md-3">
                <ul class="list-unstyled">
                  <li><a href="#">Jobs</a></li>
                  <li><a href="#">Our team</a></li>
                  <li><a href="#">Leadership</a></li>
                  <li><a href="#">Privacy Policy</a></li>
                </ul>
              </div>

              <div class="col-6 col-sm-6 col-md-3">
                <ul class="list-unstyled">
                  <li><a href="#">Nordic Chair</a></li>
                  <li><a href="#">Kruzo Aero</a></li>
                  <li><a href="#">Ergonomic Chair</a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>

        <div class="border-top copyright">
          <div class="row pt-4">
            <div class="col-lg-6">
              <p class="mb-2 text-center text-lg-start">
                Copyright &copy;
                <script>
                  document.write(new Date().getFullYear());
                </script>
                . All Rights Reserved. &mdash; Designed with love by
                <a href="https://untree.co">Untree.co</a> Distributed By
                <a hreff="https://themewagon.com">ThemeWagon</a>
                <!-- License information: https://untree.co/license/ -->
              </p>
            </div>

            <div class="col-lg-6 text-center text-lg-end">
              <ul class="list-unstyled d-inline-flex ms-auto">
                <li class="me-4"><a href="#">Terms &amp; Conditions</a></li>
                <li><a href="#">Privacy Policy</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- End Footer Section -->

    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/tiny-slider.js"></script>
    <!--<script src="js/custom.js"></script>-->
  </body>

  <!-- JavaScript -->
  <script>
    const appDiv = document.getElementById("loginOrRegister");

    // Function to render the login form
    function renderLoginForm() {
      appDiv.innerHTML = `
      <div class="untree_co-section">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-md-6 col-lg-6 pb-4">
              <div class="block">
                <h3 class="text-center mb-4">Login or Register</h3>
                <form id="loginForm">
                  <div class="form-group mb-3">
                    <label class="text-black" for="email">Email Address</label>
                    <input
                      type="email"
                      class="form-control"
                      id="email"
                      name="email"
                      placeholder="Enter your email"
                      required
                    />
                    <div class="invalid-feedback">
                      Please enter a valid email address.
                    </div>
                  </div>
                  <div class="form-group mb-3">
                    <label class="text-black" for="password">Password</label>
                    <input
                      type="password"
                      class="form-control"
                      id="password"
                      name="password"
                      placeholder="Enter your password"
                      minlength="6"
                      required
                    />
                    <div class="invalid-feedback">
                      Password must be at least 6 characters.
                    </div>
                  </div>
                  <div class="form-group text-center">
                    <button type="submit" class="btn btn-primary w-100">
                      Login
                    </button>
                  </div>
                  <div class="text-center mt-3">
                    <button type="button" class="btn btn-link" onclick="renderRegisterForm()">
                      Don't have an account? Register
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;

      // Attach event listener for login form submission
      document
        .getElementById("loginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          // Call login API
          loginUser(email, password);
        });
    }

    // Function to render the register form
    function renderRegisterForm() {
      appDiv.innerHTML = `
      <div class="untree_co-section">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-md-6 col-lg-6 pb-4">
              <div class="block">
                <h3 class="text-center mb-4">Register</h3>
                <form id="registerForm">
                  <div class="form-group mb-3">
                    <label class="text-black" for="name">Full Name</label>
                    <input
                      type="text"
                      class="form-control"
                      id="name"
                      name="name"
                      placeholder="Enter your full name"
                      required
                    />
                  </div>
                  <div class="form-group mb-3">
                    <label class="text-black" for="email">Email Address</label>
                    <input
                      type="email"
                      class="form-control"
                      id="email"
                      name="email"
                      placeholder="Enter your email"
                      required
                    />
                  </div>
                  <div class="form-group mb-3">
                    <label class="text-black" for="password">Password</label>
                    <input
                      type="password"
                      class="form-control"
                      id="password"
                      name="password"
                      placeholder="Enter your password"
                      minlength="6"
                      required
                    />
                    <div class="invalid-feedback">
                      Password must be at least 6 characters.
                    </div>
                  </div>
                  <div class="form-group text-center">
                    <button type="submit" class="btn btn-primary w-100">
                      Register
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    `;

      // Attach event listener for registration form submission
      document
        .getElementById("registerForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          // Call register API
          registerUser(name, email, password);
        });
    }

    // Function to handle login API call
    function loginUser(email, password) {
      fetch("http://localhost:5001/api/user/login", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ email, password }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.token) {
            // Save the token and name to localStorage
            localStorage.setItem("userToken", data.token);
            localStorage.setItem("userEmail", email);
            localStorage.setItem("userName", data.user.name); // Save the user's name
            renderLoggedInView(data.user.name);
          } else {
            alert(data.message || "Login failed");
          }
        })
        .catch((error) => {
          console.error("Error during login:", error);
          alert("Login failed, please try again.");
        });
    }

    // Function to handle register API call
    function registerUser(name, email, password) {
      fetch("http://localhost:5001/api/user/register", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ name, email, password }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.message === "User registered successfully") {
            // Save the name and token to localStorage directly after successful registration
            localStorage.setItem("userName", name); // Save the name
            localStorage.setItem("userEmail", email); // Save the email
            localStorage.setItem("userToken", data.token); // Save the token

            // Show the logged-in view with the name and logout button
            renderLoggedInView(name);
          } else {
            alert(data.message || "Registration failed");
          }
        })
        .catch((error) => {
          console.error("Error during registration:", error);
          alert("Registration failed, please try again.");
        });
    }

    // Function to render the logged-in view with name and logout button
    function renderLoggedInView(name) {
      appDiv.innerHTML = `
      <div class="untree_co-section">
        <div class="container text-center">
          <h3>Welcome, ${name}</h3>
          <button id="logoutButton" class="btn btn-danger mt-3">
            Logout
          </button>
        </div>
      </div>
    `;

      // Attach event listener for logout button
      document
        .getElementById("logoutButton")
        .addEventListener("click", function () {
          localStorage.removeItem("userName");
          localStorage.removeItem("userToken");
          localStorage.removeItem("userEmail");
          localStorage.removeItem("productList");
          renderLoginForm(); // Re-render login form after logout
        });
    }

    // Initial Render
    const storedName = localStorage.getItem("userName");
    if (storedName) {
      renderLoggedInView(storedName);
    } else {
      renderLoginForm();
    }
  </script>

  <script>
    $(document).ready(function () {
      // Retrieve the product list from localStorage
      var productList = JSON.parse(localStorage.getItem("productList"));
      localStorage.setItem("productList", JSON.stringify(productList));
      console.log(productList);
      if (productList && productList.length > 0) {
        // If productList is not empty, populate the table with products
        populateTable(productList);
        calculateTotals(productList);
      } else {
        // If productList is empty or not found, display a message or handle as needed
        $("#cart-items").append(
          "<tr><td colspan='4'>No products in the cart</td></tr>"
        );
      }

      // Attach click event handler to "X" buttons to remove products
      $("#cart-items").on("click", ".btn-remove", function () {
        var index = $(this).closest("tr").index();
        productList.splice(index, 1); // Remove the product from the list
        localStorage.setItem("productList", JSON.stringify(productList)); // Update localStorage
        $(this).closest("tr").remove(); // Remove the corresponding table row
        //populateTable(productList);
        calculateTotals(productList);
        if (productList && productList.length == 0)
          $("#cart-items").append(
            "<tr><td colspan='4'>No products in the cart</td></tr>"
          );
      });
    });

    function calculateTotals(productList) {
      var subtotal = 0;
      // Calculate the subtotal by summing up the prices of all products
      productList.forEach(function (product) {
        subtotal += product.price;
      });

      // Calculate the tax amount (13%)
      var taxAmount = subtotal * 0.13;

      // Calculate the total including tax
      var total = subtotal + taxAmount;

      // Display the subtotal, tax amount, and total
      $(".subtotal").text("$" + subtotal.toFixed(2));
      $(".tax").text("$" + taxAmount.toFixed(2));
      $(".total").text("$" + total.toFixed(2));
    }

    function populateTable(productList) {
      // Loop through the productList and generate table rows for each product
      productList.forEach(function (product) {
        var tableRow =
          "<tr>" +
          "<td class='product-thumbnail'><img src='" +
          product.img +
          "' alt='Image' class='img-fluid' style='width: 100px; height: 100px; object-fit: scale-down;'></td>" +
          "<td class='product-name'><h2 class='h5 text-black'>" +
          product.name +
          "</h2></td>" +
          "<td>$" +
          product.price.toFixed(2) +
          "</td>" +
          "<td><a class='btn btn-black btn-sm btn-remove'>X</a></td>" +
          "</tr>";
        $("#cart-items").append(tableRow);
      });
    }
  </script>
</html>
